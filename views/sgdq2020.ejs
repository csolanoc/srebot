<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/main.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.4.2/gsap.min.js"></script>

    <!-- <script>
        document.addEventListener('DOMContentLoaded', function(){
            fetch('https://horaro.org/-/api/v1/schedules/2611l3e22e06sa7a21', 
            {
                method: 'GET',
                headers:{
                    'Access-Control-Allow-Origin': 'null'
                },
            })
            .then(response => response.json())
            .then(data =>{
                console.log(data);
            })
            .catch(err =>{
                console.error(err);
            })
        })
    </script> -->
</head>
<body>

    <!-- <img src="./images/plantilla_sgdq2020.png" alt="plantilla"> -->

    <div id="left-bar">
        <div id="coms-title">
            <div class="text" id="coms-text">COMENTARISTAS</div>
        </div>
        <div id="coms">
            <div id="coms-inner"></div>
        </div>

        <div id="next-runs">
            <div id="runs-container">
                <div class="text" id="runs">MÁS TARDE</div>
            </div>
            <div id="lines-next">
                <div id="lines-container">
                    <ul class="text" id="nextList">
                        <!-- <li>Gunvolt Chronicles: Luminous Avenger iX</li>
                        <li>Castle of Illusion Starring Mickey Mouse</li>
                        <li>The Legend of Zelda: Twilight Princess HD</li>
                        <li>Quest for Glory I: So You Want To Be A Hero (EGA)</li> -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="bot-bar">
        <div id="sgdq-logo">
        </div>
        <img src="./images/sre-logo-ng.png" alt="sre-logo" id="sre-logo">
        <div id="social">
            <div id="social-container">
                <div id="marco-social">
                    <ul>
                        <li>
                            <div id="social-message">
                                <span class="text">Síguenos en nuestras redes sociales</span>
                            </div>
                        </li>
                        <li>
                            <div id="twitter">
                                <img id="tw-icon" src="./images/twitter.svg" alt="twitter">
                                <span class="text">@SPEEDRUNESPANOL</span>
                            </div>
                        </li>
                        <li>
                            <div id="youtube">
                                <img id="yt-icon" src="./images/youtube.svg" alt="youtube">
                                <span class="text" id="yt-text">SPEEDRUNSESPANOL</span>
                            </div>
                        </li>
                    </ul>
                    <div id="marco-bg"></div>
                </div>
            </div>
        </div>

        <script>

            document.addEventListener('DOMContentLoaded', function(){
                let tl = gsap.timeline({repeat:-1, repeatDelay: 20});
                // let tl2 = gsap.timeline({repeat:-1, repeatDelay: 10});
                let offset = -300;

                //social-message
                tl.from('#marco-bg, #marco-social',{duration: 2, x:-offset, height:'90px', width:'0px'})
                tl.to('#marco-bg',{duration: 2, marginLeft:0}, "-=2")
                tl.from("#social-message", {duration: 1, opacity: 0, x: -offset, ease: "back.out(1)"}, "+=2")
                tl.to("#social-message", {duration: 1, opacity: 0, x: offset}, "+=5")
                tl.to('#marco-bg, #marco-social',{duration: 2, x:-offset, height:'90px', width:'10px'}, "+=2")
                tl.to('#marco-bg',{duration: 2, marginLeft:-300}, "-=2")

                //twitter
                tl.to('#marco-bg, #marco-social',{duration: 2, x:0, height:'90px', width:'600px'}, "+=5")
                tl.to('#marco-bg',{duration: 2, marginLeft:0}, "-=2")
                tl.from("#twitter", {duration: 1, opacity: 0, x: -offset, ease: "back.out(1)"}, "+=2")
                tl.to("#twitter", {duration: 1, opacity: 0, x: offset}, "+=5")
                tl.to('#marco-bg, #marco-social',{duration: 2, x:-offset, height:'90px', width:'10px'}, "+=2")
                tl.to('#marco-bg',{duration: 2, marginLeft:-300}, "-=2")


                //youtube
                tl.to('#marco-bg, #marco-social',{duration: 2, x:0, height:'90px', width:'600px'}, "+=5")
                tl.to('#marco-bg',{duration: 2, marginLeft:0}, "-=2")
                tl.from("#youtube", {duration: 1, opacity: 0, x: -offset, ease: "back.out(1)"}, "+=2")
                tl.to("#youtube", {duration: 1, opacity: 0, x: offset}, "+=5")
                tl.to('#marco-bg, #marco-social',{duration: 2, x:-offset, height:'90px', width:'10px'}, "+=2")
                tl.to('#marco-bg',{duration: 2, marginLeft:-300}, "-=2")
                tl.to('#marco-bg, #marco-social',{duration: 2, opacity:0}, "+=2")






                // //social-message
                // tl2.to('#marco-social',{duration: 1, y: offset-10})
                // tl.to("#social-message", {duration: 1, opacity: 1, y: offset, ease: "back.out(1)"})
                // tl.to("#social-message", {duration: 1, opacity: 0, y: -offset}, "+=5")
                // tl2.to('#marco-social',{duration: 1, y: -offset+10}, "+=5")

                // //twitter
                // tl2.to('#marco-social',{duration: 1, y: offset-10}, "+=5")
                // tl.to("#twitter", {duration: 1, opacity: 1, y: offset, ease: "back.out(1)"}, "+=5.3")
                // tl.to("#twitter", {duration: 1, opacity: 0, y: -offset}, "+=5")
                // tl2.to('#marco-social',{duration: 1, y: -offset+10}, "+=5.3")

                // //youtube
                // tl2.to('#marco-social',{duration: 1, y: offset-10}, "+=5")
                // tl.to("#youtube", {duration: 1, opacity: 1, y: offset, ease: "back.out(1)"}, "+=5.3")
                // tl.to("#youtube", {duration: 1, opacity: 0, y: -offset}, "+=5")
                // tl2.to('#marco-social',{duration: 1, y: -offset+10}, "+=5.3")
            })
        </script>

    </div>
    <div id="left-container">
        <div id="line-left"></div>
    </div>
    <div id="bot-container">
        <div id="line-bot"></div>
    </div>


    <button onclick="avanzar(this)" class="text" id="avanzar" style="position: absolute; top: 1080px; left: 300px; width: 300px; height: 200px; background-color: red;">Avanzar</button>
    <button onclick="retroceder(this)" class="text" id="retroceder" style="position: absolute; top: 1080px; left: 0px; width: 300px; height: 200px; background-color: red">Retroceder</button>

    <script> 
        let lista;
        let showRuns = [];
        let runs = <%-JSON.stringify(nextRuns)%>;
        let cont = <%-JSON.stringify(horarioCounter)%>;
        let cont2 = 0;

        document.addEventListener('DOMContentLoaded', ()=>{
            lista = document.getElementById('nextList')

            while(lista.firstChild){
                lista.removeChild(lista.firstChild);
            }
            while(cont < runs.length && cont2 < 4){
                let li = document.createElement('li');
                li.class = 'childList';
                li.id = `${cont}`;
                li.innerHTML=`${runs[cont]}`;
                li.style.animationName = 'fadeRunGone';
                li.style.animationIterationCount = '1';
                li.style.animationDuration = '2s';
                li.style.animationPlayState = 'paused';
                lista.appendChild(li)
                cont2++;
                cont++;
            }
            cont2 == 0;
        })

        function avanzar(button){
                lista = document.getElementById('nextList')
                let first = lista.firstChild;
                let li;
                // console.log(`tama;o de cont ${cont} y de runs ${runs.length} y de lista ${lista.getElementsByTagName('li').length}`)
                // console.log(lista.firstChild)
                if(cont < runs.length){
                    li = document.createElement('li');
                    li.class = 'childList';
                    li.id = `${cont}`;
                    li.innerHTML = `${runs[cont]}`;
                    li.style.animationName = 'fadeRunIn';
                    li.style.animationIterationCount = '1';
                    li.style.animationDuration = '2s';
                    li.style.animationPlayState = 'paused';
                    lista.appendChild(li)
                    cont++;

                    if(lista.childNodes.length < 6){
                        li.style.animationPlayState = 'running';
                    }
                    lista.firstChild.style.animationPlayState = 'running';
                    button.disabled = true;
                    document.getElementById('retroceder').disabled = true;

                    first.addEventListener('animationend', () =>{
                        li.style.animationName = 'fadeRunGone';
                        li.style.animationPlayState = 'paused';
                    })

                    lista.firstChild.addEventListener('animationend', () =>{
                        lista.removeChild(lista.firstChild);
                        button.disabled = false;
                        document.getElementById('retroceder').disabled = false;
                    })


                }else{
                    lista.firstChild.style.animationPlayState = 'running';
                    button.disabled = true;
                    document.getElementById('retroceder').disabled = true;
                    lista.firstChild.addEventListener('animationend', () =>{
                        lista.removeChild(lista.firstChild);
                        button.disabled = false;
                        document.getElementById('retroceder').disabled = false;
                    })
                }

                // while(lista.getElementsByTagName('li').length > 4){
                //     lista.firstChild.addEventListener('animationend', () =>{
                //         lista.removeChild(lista.firstChild);
                //     })
                // }

                if(lista.getElementsByTagName('li').length === 0){
                    let li = document.createElement('li');
                    li.class = 'childList';
                    li.innerHTML = `Se acabó`;
                    lista.appendChild(li)
                }

                // console.log(`tama;o de cont ${cont} y de runs ${runs.length} y de lista ${lista.getElementsByTagName('li').length}, y la info del primer hijo ${lista.firstChild.innerHTML}`)
                // console.log(`contador ${cont}`)
            }

        function retroceder(button){
            lista = document.getElementById('nextList')

            if(cont > 0){
                cont--;
                let li = document.createElement('li');
                li.class = 'childList';
                li.id = parseInt(lista.firstChild.id)-1;
                li.innerHTML = `${runs[li.id]}`;
                li.style.animationName = 'fadeRunIn';
                li.style.animationIterationCount = '1';
                li.style.animationDuration = '2s';
                li.style.animationPlayState = 'paused';
                lista.insertBefore(li, lista.childNodes[0]);

                lista.firstChild.style.animationPlayState = 'running';
                lista.lastChild.style.animationName = 'fadeRunGone';

                button.disabled = true;
                document.getElementById('avanzar').disabled = true;

                // console.log(lista.childNodes.length)
                if(lista.childNodes.length > 4){
                    lista.lastChild.style.animationPlayState = 'running';

                    lista.lastChild.addEventListener('animationend', () =>{
                        lista.removeChild(lista.lastChild)
                        button.disabled = false;
                        document.getElementById('avanzar').disabled = false;
                        li.style.animationName = 'fadeRunGone';
                        li.style.animationPlayState = 'paused';
                    })
                }else{
                    lista.firstChild.addEventListener('animationend', ()=>{
                        button.disabled = false;
                        document.getElementById('avanzar').disabled = false;
                        li.style.animationName = 'fadeRunGone';
                        li.style.animationPlayState = 'paused';
                        // console.log(lista.childNodes.length)
                        if(lista.childNodes.length < 5)
                            cont++;
                            while(cont > runs.length)
                                cont--;
                    })
                }
                

            }
            // console.log(`contador ${cont}`)
        }
    </script>

</body>
</html>